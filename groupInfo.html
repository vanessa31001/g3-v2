<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title"></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.12/vue.js"></script> 
    <script src="./vender/vue/vue.min.js"></script>
    <script src="./vender/jquery/jquery-3.5.1.min.js"></script>
    <script src="./js/main.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="shortcut icon" href="./pic/commom/browser.ico">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div id="groupAllList">
    <!-- header開始-->
    <header >
    <div class="forphone">
    <button class="hamburger hamburger--spring" type="button">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>
    </div>
    <nav class="wrap_nav">
        <div class="nav_logo">
            <a class="logo_link -bottom">
                <img class="desk sun" src="./pic/commom/sun.svg" alt="">
            </a>
            <a class="changelogo" href="./shansen.html">
            <img class="phone" src="./pic/commom/phone_header.svg">
            </a>
            <div class="middle_bg"></div>
            <a href="./shansen.html" class="logo_link -up">
                <img class="desk" src="./pic/commom/pc_header.svg">
            </a>
        </div>
        <div class="nav_list">
            <ul >
                <li><a class="nav_title orange2" href="./group.html">揪團露營</a></li>
                <li><a class="nav_title @@underline_02" href="./equipment.html">設備交換</a></li>
                <li><a class="nav_title @@underline_03" href="./camping.html">營區攻略</a></li>
                <li><a class="nav_title @@underline_04" href="./letter.html">來去寫信</a></li>
                <li><a class="nav_title @@underline_05" href="./aboutus.html">關於我們</a></li>
                <li><a href="./member.html" id="header_memName">&nbsp;</a>
                    <a class="nav_title @@underline_06" id="spanLogin">登入|註冊</a>
                </li>
            </ul>
        </div>
    </nav>
</header>
    <!-- 燈箱開始 -->
    <div id="outerDiv">
    <div id="lightBox">
        <input type="checkbox" id="login_img_control" name="login">
        <div class="login_container">
            <div id="logiMember">
                <table border="1" align="center" cellspacing="0" id="tableLogin" class="login_block_left">
                    <tr><td colspan="2" align="center"><a href="./shansen.html"  class="logo_link_logo">
                        <img class="login_logo"  style="width: 75px;padding: 20px 5px 10px 0px;" src="./pic/commom/1017_logo.png" alt="">
                    </a></td></tr>
                    <tr><td colspan="2" align="center" class="sub_title">會員登入</td></tr>
                    <tr><td>帳號：</td><td><input class="inputstyle" type="text" name="memId" id="LoginMemId" placeholder="請輸入您的Email"></td></tr>
                    <tr><td>密碼：</td><td><input class="inputstyle" type="password" name="memPsw" id="LoginMemPsw" placeholder="請輸入密碼(6-20英數字)"></td></tr>
                    <tr><td colspan="2" align="center">
                        <input type="button" id="btnLogin" value="登入" class="thirdbtn1_green">  
                        <input type="button" id="btnLoginCancel" value="取消" class="thirdbtn2_green">  
                    </td></tr>
                    <tr><td colspan="2" align="center" class="level1">
                        <p id="forgetPsw">忘記密碼?</p>
                        <label for="login_img_control">
                            <span id="to_register_btn">還沒申請帳號?</span>
                        </label>
                    </td></tr>
                </table>
            </div>
            <form id="reiMember">
                <table align="center" cellspacing="0" id="register" class="login_block_right">
                    <tr><td colspan="2" align="center"><a href="./shansen.html" class="logo_link_logo">
                        <img class="login_logo"  style="width: 75px;padding: 20px 5px 10px 0px;" src="./pic/commom/1017_logo.png" alt="">
                    </a></td></tr>
                    <tr><td colspan="2" align="center" class="sub_title">註冊會員</td></tr>
                    <tr><td>會員帳號：</td><td><input class="inputstyle" type="text" name="memId" id="RegiMemId" placeholder="請輸入您的Email"></td></tr>
                    <tr><td>會員密碼：</td><td><input class="inputstyle" type="password" name="memPsw" id="RegiMemPsw" placeholder="請輸入密碼(6-20英數字)"></td></tr>
                    <tr><td>確認密碼：</td><td><input class="inputstyle" type="password" name="memPsw_check" id="RegiDCMemPsw" placeholder="請再次輸入密碼"></td></tr>
                    <tr><td>會員姓名：</td><td><input class="inputstyle" type="text" name="memName" id="RegiMemName" placeholder="請輸入您的姓名"></td></tr>
                    <tr><td>會員暱稱：</td><td><input class="inputstyle" type="text" name="memNice" id="RegiMemNickname" placeholder="請輸入您的暱稱"></td></tr>
                    <tr><td colspan="2" align="center">
                        <input type="button" id="btnRegi" value="註冊" class="thirdbtn1_green">  
                        <input type="button" id="btnRegiCancel" value="取消" class="thirdbtn2_green">  
                    </td></tr>
                    <tr><td colspan="2" align="center" class="level1">
                        <label for="login_img_control">
                            <span id="to_login_btn">已有會員帳號?</span>
                        </label>
                    </td></tr>
                </table>
            </form>
            <div class="login_block_mid">
                <img src="./pic/commom/mid_pic.svg" alt="登入頁照片">
            </div>
        </div>
    </div>
</div>
    <!-- 燈箱結束 -->
    <section class="section1 bgcColor">
        <div class="wrap lightbox">
            <div class="grouninfostyle">
                <div class="level11 green1">
                    揪團露營
                </div>
                <div>
                    <a href="#" class="startNewGroup" onclick="startNewGroup()"><button class="mainbtn1">我要開團</button><img src="./pic/group/newgroup-01.svg" alt=""></a>

                </div>
            </div>
            
            
            <div class="breadcrumbs">
                <ul>
                    <li><a href="./shansen.html"  class="level0 green1">首頁</a></li>
                    <li><a href="./group.html"  class="level0 green1">揪團露營</a></li>
                    <li class="level0 gray1" id="thisPage"></li>
                </ul>
            </div>
            <!-- 檢舉lightbox -->
            <div class="report_overlay">
                <article>
                    <form class="report_form" action="">
                        <div class="level7 bold green1 report_title">檢舉原因</div>                        
                        <div class="report_reason1 level1 gray1">
                            <input type="radio" name="reason0" id="report_equ1">
                            <label for="report_equ1">1</label>
                        </div>
                        <div class="report_reason2 level1 gray1"> 
                            <input type="radio" name="reason0" id="report_equ2">
                            <label for="report_equ2">2</label>
                        </div>
                        <div class="report_reason3 level1 gray1">
                            <input type="radio" name="reason0" id="report_equ3">
                            <label for="report_equ3">3</label>
                        </div>
                        <div class="report_close_btn">
                            <button type="button" class="thirdbtn1_green submit_btn" id="reportSend">送出</button>
                            <!-- <input class="thirdbtn1_green submit_btn" type="submit" id="reportSend" value="送出"> -->
                            <button type="button" class="thirdbtn2_green btn_modal_close">取消</button>
                        </div>                                        
                    </form>                      
                </article>
            </div>
            <div class="groupMain">
                <div class="groupBlock groupBlockI">
                    <div class="ginside group gray1 ">
                        <!-- <div class="hot">
                            <p class="white">熱門景點</p>
                        </div> -->
                        <div class="gLeft">
                            <div class="pic picI">
                                <label class="uploadImg ginsideImg uploadImgI">
                                    <!-- <input type="file" id="theFile"> -->
                                    <img id="pic1" alt="" class="nowPic">
                                </label>
                                <div class="imgs">
                                    <div class="img now"><img id="pic2" alt=""></div>
                                    <div class="img"><img id="pic3" alt=""></div>
                                    <div class="img"><img id="pic4" alt=""></div>
                                </div>
                            </div>
                            <div class="maphashtagI maphashtag ">
                                <a href="" id="countyA">
                                    <input type="submit" class="tagbtn_green" id="county">
                                </a>
                                <a href="" id="camNameA">
                                    <input type="submit" class="tagbtn_green" id="camName">
                                </a>
                            </div>
                            
                        </div>
                        <div class="gRight">
                            <div class="headLine">
                                <h3 class="level7 green1" id="GROUPNAME"></h3>
                                <div class="smallInfo">
                                    <h6 class="level0 gray1" id="GROUP_START_DATE"></h6>
                                    <input type="hidden" id="groupID">
                                    <input type="submit" class="reportbtngGroup" value="檢舉" id="report">

                                </div>
                            </div>
                            <fieldset class="poster_inform">
                                <legend class="level1 green3 poster">主揪</legend>
                                <div class="inform_block">
                                    <div class="inform_pic">
                                           <img id="MEMIMG" alt="">
                                    </div>
                                    <div class="inform_text">
                                        <h4 class="third_title" id="MEMNICKNAME"></h4>
                                    </div>                                                                     
                                </div>
                            </fieldset>
                            <span>相關介紹 :</span>
                            <p class="info infomore" id="GROUP_INTRO">
                            </p>
                            <p id="GROUP_DEPART_DATE">
                            </p>
                            <p id="GROUP_DEADLINE">
                            </p>
                            <div class="aboutPepole">
                                <div>
                                    <p id="GROUP_PEOPLE_LIMIT">
                                        <span>人數上限 :</span> {{limPepole}}人
                                    </p>
                                </div>
                                <div class="right">
                                    <p class="note" id="REMAIN_PEOPLE">
                                        <!-- 目前只剩{{leastPepole}}個名額囉~ -->
                                    </p>
                                </div>
                                
                            </div>
                            <div class="equthing">
                                <span>須具備設備 :</span>
                                <div id="equthing">
                                </div>
                            </div>
                            <div  id="forBtn">
                                <input type="submit" value="我要參加" id="joinGroup">
                            </div>
                        </div>
                    </div>     
                </div>
            </div>
        </div>
    </section>
    <!-- 團員 -->
    <section class="section2 bgcColor gray1">
        <div class="wrap">
            <div class="level11 green1">
                參加團員
            </div>
            <div class="gPepole groupBlock" id="memberIn">

            </div>
        </div>
    </section>
    <!-- 留言 -->
    <section class="section2 bgcColor gray1">
        <div class="wrap">
            <div class="level11 green1">
                留言
                <div class="gPepole groupBlock gMessage" id="massages">
      
                </div>
                <div class="myMsg level5">
                    我要留言
                    <div>
                        <textarea name="" class="inputstyle" id="leaveMsg" cols="60" rows="3" placeholder="任何想說或是想問的嗎?" ></textarea>
                        <input type="submit" value="送出" class="thirdbtn1_green" id="sendMsg">
                    </div>
                    
                </div>
                

            </div>
        </div>
    </section>
    
    <!-- 其他 -->
    <section class="section2 moreGroups bgcColor gray1">
        <div class="wrap">
            <div class="level11 green1">
                你可能感興趣的揪團
            </div>
            <div class="gPepole groupBlock moreGroups">
                <button class="tagbtn_yellow" id="leftBtn">&lt;</button>
                <div class="oGroups">
                    <ul class="allGroup" id="allGroup">
                    </ul>
                </div>
                <button class="tagbtn_yellow" id="rightBtn">&gt;</button>
            </div>
        </div>
    </section>

    <!-- footer 開始-->
    <footer>
    <div class="footer_bgc">
        <div class="wrap">
            <div class="footerarrange">
                <div class="footright">
                    <div class="level2 green1">聯絡資訊 |</div>
                    <div class="level0 green1">
                        電子信箱|ShanSen@gmail.com<br>
                        營業時間|週二至週日 10:00~20:00(國定假日休假)
                    </div>
                </div>
                <div class="footercenter">
                    <a href="./shansen.html">
                        <img src="./pic/commom/pc_header.svg">
                    </a>
                </div>
                <div class="footerright">
                    <div class="link">
                        <div class="level2 green1">相關連結 |</div>
                        <div class="footer_icon">
                            <img src="./pic/commom/foot_line.svg" alt="">
                            <img src="./pic/commom/foot_ig.svg" alt="">
                            <img src="./pic/commom/foot_fb.svg" alt="">
                            <img src="./pic/commom/foot_email.svg" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="copyright">Copyright &copy; 2020ShanSen</div>
</footer>
    <!-- footer 結束-->

    </div>
    <script src="./js/logintext.js"></script>
    <script src="./js/normalFunc.js"></script>
    <script> 
        // setTimeout(function(){
        var joinGroup = $id("joinGroup");
            joinGroup.addEventListener("click", function(){
            var url = location.href;
            var groupNo = url.split('?')[1].split('=');
            if(member.MEMNO){
                // if(joinGroup.value==="我要參加"){//會員
                var groupNO = $id("groupID").value;
                var joinxhr = new XMLHttpRequest();
                joinxhr.onload=function (){
                    if( joinxhr.status == 200 ){
                        reason= JSON.parse(joinxhr.responseText);
                        swal(reason);

                    }else{
                        alert(joinxhr.responseText);
                    }
                    // readPage(groupNo);
                    doFirst();
                }
                var url = `./php/group/joinGroup.php?GROUP_NO=${groupNO}&MEMNO=${member.MEMNO}`;
                joinxhr.open("Get", url, true);
                joinxhr.send( null ); 
                // }      
                // }else if(joinGroup.value==="我要退團"){//參團者退團
                //     var groupNO = $id("groupID").value;
                //     var joinxhr = new XMLHttpRequest();
                //     joinxhr.onload=function (){
                //         if( joinxhr.status == 200 ){
                //             reason= JSON.parse(joinxhr.responseText);
                //             swal(reason);
                //             joinGroup.value="我要參加";

                //         }else{
                //             alert(joinxhr.responseText);
                //         }
                //         doFirst();
                //     }
                //     var url = `./php/group/unjoinGroup.php?GROUP_NO=${groupNO}&MEMNO=${member.MEMNO}`;
                //     joinxhr.open("Get", url, true);
                //     joinxhr.send( null ); 

                // }else{//主揪關閉

                //     // var groupNO = $id("groupID").value;
                //     // var joinxhr = new XMLHttpRequest();
                //     // joinxhr.onload=function (){
                //     //     if( joinxhr.status == 200 ){
                //     //         reason= JSON.parse(joinxhr.responseText);
                //     //         swal(reason);
                //     //         joinGroup.value="";

                //     //     }else{
                //     //         alert(joinxhr.responseText);
                //     //     }
                //     //     doFirst();
                //     // }
                //     // var url = `./php/group/unjoinGroup.php?GROUP_NO=${groupNO}&MEMNO=${member.MEMNO}`;
                //     // joinxhr.open("Get", url, true);
                //     // joinxhr.send( null );

                // }
            }else{
                showLoginForm();
            }
            
        });
        // },500);
    
        //參加團員
        function peopleIn(){
            let memberIn=$id("memberIn");
            memberIn.innerHTML="";
            if(groupsdata[2]==""){
                memberIn.innerText = "目前尚無人參加";
                memberIn.style.textAlign="center";
                memberIn.className+=" green1 level5";
            }
            else{
                for(let i=0; i<groupsdata[2].length ;i++){
                    let inform_block =$create("div");
                    inform_block.className="inform_block";
                    if(groupsdata[2].length>4){
                        inform_block.style["margin-bottom"] = "10px";
                    }
                    $append(memberIn,inform_block);
                    let inform_pic = $create("div");
                    inform_pic.className =  "inform_pic";
                    $append(inform_block,inform_pic);
                    let img = $create("img");
                    img.src = "./pic/member/"+groupsdata[2][i].MEM_IMG;
                    $append(inform_pic,img);
                    let inform_text = $create("div");
                    inform_text.className =  "inform_text";
                    $append(inform_block,inform_text);
                    let h4 = $create("H4");
                    h4.className ="third_title";
                    h4.innerText = groupsdata[2][i].MEM_NICKNAME;
                    $append(inform_text,h4);
                }
            }
        }
        //設備
        function getEQU(){
            let equthing = $id(`equthing`);
            equthing.innerHTML="";
            if(groupsdata[3] == "沒資料"){
                equthing.innerText = "此團無須自備設備";
                equthing.style.fontSize ="16px";
            }else{
                let a;
                for(let j=0; j<groupsdata[3].length ; j++){
                    a=$create("a");
                    a.className="equ";
                    a.href=`./equipment.html#${groupsdata[3][j].G_EQU_NO}`;
                    a.innerHTML = ` <button class="tagbtn_yellow">${groupsdata[3][j].EQUSORT_EQUNAME}</button>`;
                    $append(equthing,a);
                }
                let p = $create("p");
                p.className = "gray2";
                p.innerText = "(標籤可到設備交換區)"
                $append(equthing,p);
                
            }
        }
        //其他揪團
        function othergroups(){
            let allGroup = $id("allGroup");
            allGroup.innerHTML="";
            for(let i=0;i<groupsdata[4].length;i++){
                let li=$create("li");
                li.className="group";
                li.innerHTML=`
                <div class="img">
                    <img src="./pic/group/${groupsdata[4][i].GROUP_PIC1}" alt="圖片出問題">
                </div>
                <div class="info ">
                    <div class="gName level5 green1">
                        ${groupsdata[4][i].GROUP_NAME}
                    </div>
                    <div class="btns">
                        <div class="maphashtagI maphashtag">
                            <input type="submit" class="tagbtn_green" value="${groupsdata[4][i].CAM_COUNTY}">
                            <input type="submit" class="tagbtn_green" value="${groupsdata[4][i].CAM_NAME}">
                        </div>
                        <div class="more">
                            <a href="./groupInfo.html?GROUP_NO=${groupsdata[4][i].GROUP_NO}"><input type="submit" class="secondbtn1" value="查看詳情"></a>
                        </div>
                    </div>
                </div>
                `;
                $append(allGroup,li);
            }
        }
        //揪團
        function showgroupinfo(groupNo){
            $id("groupID").value=groupNo;
            $id("thisPage").innerText = groupsdata[0].GROUP_NAME;
            $id("title").innerText = groupsdata[0].GROUP_NAME;
            $id("pic1").src ="./pic/group/"+groupsdata[0].GROUP_PIC1;
            $id("pic2").src ="./pic/group/"+groupsdata[0].GROUP_PIC1;
            $id("pic3").src ="./pic/group/"+groupsdata[0].GROUP_PIC2;
            $id("pic4").src ="./pic/group/"+groupsdata[0].GROUP_PIC3;
            $id("countyA").href="./camping.html";
            $id("county").value=groupsdata[0].CAM_COUNTY;
            $id("camName").href=`./camping.html/${groupsdata[0].CAM_NO}`;
            $id("camName").value=groupsdata[0].CAM_NAME;
            $id("GROUPNAME").innerText = groupsdata[0].GROUP_NAME;
            $id("GROUP_START_DATE").innerText = "開團時間 :" + groupsdata[0].GROUP_START_DATE;
            $id("MEMIMG").src ="./pic/member/"+groupsdata[0].MEM_IMG;
            $id("MEMNICKNAME").innerText = groupsdata[0].MEM_NICKNAME;
            $id("GROUP_INTRO").innerText = groupsdata[0].GROUP_INTRO;
            $id("GROUP_DEPART_DATE").innerHTML = "<span>出團日期 :</span>"+groupsdata[0].GROUP_DEPART_DATE;
            $id("GROUP_DEADLINE").innerHTML = "<span>結束日期 :</span>"+groupsdata[0].GROUP_DEADLINE;
            $id("GROUP_PEOPLE_LIMIT").innerHTML ="<span>人數上限 :</span>"+groupsdata[0].GROUP_PEOPLE_LIMIT+"人";
            $id("REMAIN_PEOPLE").innerHTML ="目前剩下"+groupsdata[0].REMAIN_PEOPLE+"個名額囉~";
            let forBtn = $id("forBtn");
            let joinGroupBtn = $id("joinGroup");
            let report = $id("report");
            if(member.MEMNO == groupsdata[0].GROUP_MEMNO){
                //若是主揪:關閉此團，關閉檢舉
                joinGroupBtn.style["display"] = "none";
                report.style["display"] = "none";  
            }else{
                //一般會員
                joinGroupBtn.className = "mainbtn1";
                forBtn.style["text-align"] = "center";
                if(member.MEMNO){
                    if(member.MEMNO == groupsdata[5].REGROUP_MEMNO){
                        report.style.color='#C4C4C4';
                        report.style["border-color"]="#C4C4C4";
                        report.value="已檢舉";
                        report.disabled = true;
                        report.style.cursor="default";
                    }
                }
  
                //若是參團者:我要退團，關閉檢舉
                for(let i=0; i< groupsdata[2].length; i++){
                    if(member.MEMNO == groupsdata[2][i].G_DETAIL_MEMNO){
                        joinGroupBtn.style["display"] = "none";
                        // $id("report").style["display"] = "none";
                        break;
                    }
                }
                
            }
            

        }
        //已留言
        function showMsg(){
            let massages = document.querySelector("#massages");
            massages.innerHTML="";
            document.querySelector("#leaveMsg").value="";
            if(groupsdata[1]==""){
                let msgInfo = $create("div");
                msgInfo.className="msgInfo green1 level5";
                msgInfo.innerText="尚未有人留言";
                msgInfo.style.textAlign="center";
                msgInfo.style.display="block";
                msgInfo.style["font-weight"]="normal";
                $append(massages,msgInfo);    
            }else{
                for(let i=0; i<groupsdata[1].length ;i++){
                    // 判斷是否被檢舉
                    if(groupsdata[1][i].REGROUP_MES_NO == null){
                        //若沒有被檢舉
                        let msgInfo = $create("div");
                        msgInfo.className="msgInfo";
                        //若是主揪留言
                        if(groupsdata[1][i].GROUP_MES_MEMNO==groupsdata[0].GROUP_MEMNO){
                            msgInfo.className+=" grouper";
                        }
                        msgInfo.innerHTML=`<div class="inform_block">
                                <div class="inform_pic">
                                        <img src="./pic/member/${groupsdata[1][i].MEM_IMG}" alt="">
                                </div>
                                <div class="inform_text">
                                    <p class="green1 third_title">${groupsdata[1][i].MEM_NICKNAME}</p>
                                </div>                                                                      
                            </div>
                            <div class="level1">
                                <span class="third_title">留言:</span>
                                <p class="gray1">${groupsdata[1][i].GROUP_MES_CONTENT}</p>
                            </div>
                            <div class="level0 gray1">
                                留言時間:${groupsdata[1][i].GROUP_MES_TIME} 
                            </div>
                            <input type="hidden" value="${groupsdata[1][i].GROUP_MES_NO}">
                            
                        </div>`;                    
                        $append(massages,msgInfo);
                        let input = $create("input");
                        input.type = "submit";
                        input.className ="reportbtnMsg";
                        if(groupsdata[1][i].GROUP_MES_MEMNO==member.MEMNO){
                            // <input type="submit" class="reportbtnMsg" value="檢舉">
                            input.value="刪除";
                        }else{
                            input.value="檢舉";
                        }
                        $append(msgInfo,input);
                    }else{//若被檢舉
                        let msgInfo = $create("div");
                        msgInfo.className="msgInfo";
                        // console.log(`GROUP_MES_MEMNO:${groupsdata[1][i].GROUP_MES_MEMNO} = GROUP_MEMNO: ${groupsdata[0].GROUP_MEMNO}`);
                        if(groupsdata[1][i].GROUP_MES_MEMNO==member.MEMNO){
                            //若是我的留言被檢舉
                            msgInfo.innerHTML=`<div class="inform_block">
                                                    <div class="inform_pic">
                                                            <img src="./pic/member/${groupsdata[1][i].MEM_IMG}" alt="">
                                                    </div>
                                                    <div class="inform_text">
                                                        <p class="green1 third_title">${groupsdata[1][i].MEM_NICKNAME}</p>
                                                    </div>                                                                      
                                                </div>
                                                <div class="level1">
                                                    <span class="third_title">留言:</span>
                                                    <p class="gray1">${groupsdata[1][i].GROUP_MES_CONTENT}</p>
                                                </div>
                                                <div class="level0 gray1">
                                                    (您的留言遭檢舉，目前待小編審核中)
                                                </div>
                                                <input type="hidden" value="${groupsdata[1][i].GROUP_MES_NO}">
                                                
                                            </div>`;
                        }else{
                            msgInfo.innerHTML=` <div class="level1">
                                                    <p class="gray1" style="text-align: center;">此留言已遭檢舉!</p>
                                                </div>`;
                        }
                        $append(massages,msgInfo);
                    }
                }
     
                    
            }
            
        }
        function readPage(groupNo){
            
            let groupxhr = new XMLHttpRequest();
            groupxhr.onload = function(){
                if(groupxhr.status == 200){ //success
                    groupsdata = JSON.parse(groupxhr.responseText);
                    console.log(groupsdata);
                    showgroupinfo(groupNo);
                    getEQU();
                    peopleIn();
                    showMsg();
                    othergroups();
                    // 檢舉揪團
                    var reportbtngGroup = document.querySelector(".reportbtngGroup");
                    reportbtngGroup.addEventListener("click", function() {
                        report("reportbtngGroup",this.value,this.previousSibling.previousSibling.value) 
                    });
                    //檢舉留言
                    var reportbtnMsg = document.querySelectorAll(".reportbtnMsg");
                    for(let i =0; i<reportbtnMsg.length; i++){
                      
                        reportbtnMsg[i].addEventListener("click", function (e) {
                            report("reportbtnMsg",this.value,this.previousSibling.previousSibling.value);
                        });
                    }
                    //留言
                    let leaveMsg = $id("sendMsg");
                    leaveMsg.addEventListener("click", function ttt(e){
                        
                        if(member.MEM_ID){
                            var leaveMsg =document.querySelector("#leaveMsg").value;
                            if(leaveMsg.trim()!= ""){
                                let date = formatDate(new Date());
                                let msgxhr = new XMLHttpRequest();
                                msgxhr.onload = function(){
                                    if(msgxhr.status == 200){ //success 
                                         console.log(e.target)

                                        // location.reload(); 
                                        readPage(groupNo);
                                        // showMsg();
                                    }else{
                                        console.log(msgxhr.responseText);
                                    }  
                                    $id("sendMsg").removeEventListener('click',ttt);
                                }
                                msgxhr.open("Post", "./php/group/leaveMsg.php", true);
                                msgxhr.setRequestHeader("content-type","application/x-www-form-urlencoded");
                                let data_info = `GROUP_MES_GROUPNO=${groupsdata[0].GROUP_NO}&GROUP_MES_MEMNO=${member.MEMNO}&GROUP_MES_TIME=${date}&GROUP_MES_CONTENT=${leaveMsg}`;
                                msgxhr.send(data_info);
                            }else{
                                swal("請輸入文字再送出~");
                            }
                            
                        }else{
                            showLoginForm();
                        }
                    });
                }else{ //error
                    alert(groupxhr.responseText);
                }
            }
            groupxhr.open("get", `./php/group/groupInfo.php?GROUP_NO=${groupNo}`, true);
            groupxhr.send(null);
            
        }
        function doFirst(){
            var url = location.href;
            if(url.indexOf('?')!=-1){
                var GROUP_NO = url.split('?')[1].split('=');
                readPage(GROUP_NO[1]);
    
            }else{
                alert("連結錯誤，請選別頁");
            }

        }
        window.addEventListener('load',doFirst);
    </script>

    <script>
        let imgCount ='';
        let divWidth='';
        let allwidth='';
        let count=0;
        $(window).resize(function(){
            divWidth = $('.oGroups').width(); 
            if(divWidth == 880){
                $('.allGroup').width(Math.ceil(imgCount / 2) * divWidth);
                allwidth =(Math.ceil(imgCount / 2));
            }else{
                $('.allGroup').width(Math.ceil(imgCount) * divWidth);
                allwidth =(Math.ceil(imgCount));
            }
            count=1;
            $('.allGroup').animate({
                    right: divWidth * count,
            });
        });
         
        $(setTimeout(function(){
            //要更換的圖片位置
            $('.pic .imgs .img img').click(function(){ 
                let mig = $(this).attr("src");
                $('.pic .imgs .img').removeClass("now");
                $(this).parent().addClass("now");
                $(".nowPic").attr("src", mig);      
            });   
            // 燈箱
            $(".btn_modal_close").on("click", function(){
                $(".report_overlay").addClass("-opacity-zero");
                $("input[name=reason0]").each(function(){
                    $(this).prop("checked",false);//把所有的核方框的property都取消勾選
                }); 
                setTimeout(function(){
                    $(".report_overlay").removeClass("-on -opacity-zero");
                }, 1000);
            }); 
            //更多揪團
            imgCount = $('.allGroup .group').length;
            divWidth = $('.oGroups').width(); 
            if(divWidth == 880){
                $('.allGroup').width(Math.ceil(imgCount / 2) * divWidth);
                allwidth =(Math.ceil(imgCount / 2));
            }else{
                $('.allGroup').width(Math.ceil(imgCount) * divWidth);
                allwidth =(Math.ceil(imgCount));
            }
                
            
            if(allwidth ==1){
                $('#leftBtn').hide();
                $('#rightBtn').hide();
            }else{
                $('#leftBtn').click(function(){
                if(count == 0){
                    $('#leftBtn').css('background-color', '#C4C4C4');
                    $('#leftBtn').css('border-color', '#C4C4C4');
                    $('#leftBtn').css('border-style', 'inset');
                }
                else{
                    count--; 
                    $('.allGroup').animate({
                        right: divWidth * count,
                    });
                    if(count == 0){
                        $('#leftBtn').css('background-color', '#C4C4C4');
                        $('#leftBtn').css('border-color', '#C4C4C4');
                        $('#leftBtn').css('border-style', 'solid');
                        $('#rightBtn').css('background-color', '#FFCD43');
                        $('#rightBtn').css('border-color', '#FFCD43');
                        $('#rightBtn').css('border-style', 'inset');
                    }

                }
            })
            $('#rightBtn').click(function(){
                if(count < allwidth-1){       
                    count++;
                    $('.allGroup').animate({
                        right: divWidth * count,
                    });
                    if(count == allwidth-1){
                        $('#rightBtn').css('background-color', '#C4C4C4');
                        $('#rightBtn').css('border-color', '#C4C4C4');
                        $('#rightBtn').css('border-style', 'solid');
                    }
                    else{
                        $('#rightBtn').css('background-color', '#FFCD43');
                        $('#rightBtn').css('border-color', '#FFCD43');
                        $('#rightBtn').css('border-style', 'inset');
                    }
                    if(count != 0){
                        $('#leftBtn').css('background-color', '#FFCD43');
                        $('#leftBtn').css('border-color', '#FFCD43');
                        $('#leftBtn').css('border-style', 'inset');
                    }
                }
                
            })
        
            }
        }, 500));       
    </script>
</body>
</html>