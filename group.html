<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>揪團露營</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.12/vue.js"></script> 
    <script src="./vender/vue/vue.min.js"></script>
    <script src="./vender/jquery/jquery-3.5.1.min.js"></script>
    <script src="./js/main.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="shortcut icon" href="./pic/commom/browser.ico">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    
</head>
<body>
    <div id="groupAllList">
    <!-- header開始-->
    <header >
    <div class="forphone">
    <button class="hamburger hamburger--spring" type="button">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>
    </div>
    <nav class="wrap_nav">
        <div class="nav_logo">
            <a class="logo_link -bottom">
                <img class="desk sun" src="./pic/commom/sun.svg" alt="">
            </a>
            <a class="changelogo" href="./shansen.html">
            <img class="phone" src="./pic/commom/phone_header.svg">
            </a>
            <div class="middle_bg"></div>
            <a href="./shansen.html" class="logo_link -up">
                <img class="desk" src="./pic/commom/pc_header.svg">
            </a>
        </div>
        <div class="nav_list">
            <ul >
                <li><a class="nav_title orange2" href="./group.html">揪團露營</a></li>
                <li><a class="nav_title @@underline_02" href="./equipment.html">設備交換</a></li>
                <li><a class="nav_title @@underline_03" href="./camping.html">營區攻略</a></li>
                <li><a class="nav_title @@underline_04" href="./letter.html">來去寫信</a></li>
                <li><a class="nav_title @@underline_05" href="./aboutus.html">關於我們</a></li>
                <li><a href="./member.html" id="header_memName">&nbsp;</a>
                    <a class="nav_title @@underline_06" id="spanLogin">登入|註冊</a>
                </li>
            </ul>
        </div>
    </nav>
</header>
    <!-- 燈箱開始 -->
    <div id="outerDiv">
    <div id="lightBox">
        <input type="checkbox" id="login_img_control" name="login">
        <div class="login_container">
            <div id="logiMember">
                <table border="1" align="center" cellspacing="0" id="tableLogin" class="login_block_left">
                    <tr><td colspan="2" align="center"><a href="./shansen.html"  class="logo_link_logo">
                        <img class="login_logo"  style="width: 75px;padding: 20px 5px 10px 0px;" src="./pic/commom/1017_logo.png" alt="">
                    </a></td></tr>
                    <tr><td colspan="2" align="center" class="sub_title">會員登入</td></tr>
                    <tr><td>帳號：</td><td><input class="inputstyle" type="text" name="memId" id="LoginMemId" placeholder="請輸入您的Email"></td></tr>
                    <tr><td>密碼：</td><td><input class="inputstyle" type="password" name="memPsw" id="LoginMemPsw" placeholder="請輸入密碼(6-20英數字)"></td></tr>
                    <tr><td colspan="2" align="center">
                        <input type="button" id="btnLogin" value="登入" class="thirdbtn1_green">  
                        <input type="button" id="btnLoginCancel" value="取消" class="thirdbtn2_green">  
                    </td></tr>
                    <tr><td colspan="2" align="center" class="level1">
                        <p id="forgetPsw">忘記密碼?</p>
                        <label for="login_img_control">
                            <span id="to_register_btn">還沒申請帳號?</span>
                        </label>
                    </td></tr>
                </table>
            </div>
            <form id="reiMember">
                <table align="center" cellspacing="0" id="register" class="login_block_right">
                    <tr><td colspan="2" align="center"><a href="./shansen.html" class="logo_link_logo">
                        <img class="login_logo"  style="width: 75px;padding: 20px 5px 10px 0px;" src="./pic/commom/1017_logo.png" alt="">
                    </a></td></tr>
                    <tr><td colspan="2" align="center" class="sub_title">註冊會員</td></tr>
                    <tr><td>會員帳號：</td><td><input class="inputstyle" type="text" name="memId" id="RegiMemId" placeholder="請輸入您的Email"></td></tr>
                    <tr><td>會員密碼：</td><td><input class="inputstyle" type="password" name="memPsw" id="RegiMemPsw" placeholder="請輸入密碼(6-20英數字)"></td></tr>
                    <tr><td>確認密碼：</td><td><input class="inputstyle" type="password" name="memPsw_check" id="RegiDCMemPsw" placeholder="請再次輸入密碼"></td></tr>
                    <tr><td>會員姓名：</td><td><input class="inputstyle" type="text" name="memName" id="RegiMemName" placeholder="請輸入您的姓名"></td></tr>
                    <tr><td>會員暱稱：</td><td><input class="inputstyle" type="text" name="memNice" id="RegiMemNickname" placeholder="請輸入您的暱稱"></td></tr>
                    <tr><td colspan="2" align="center">
                        <input type="button" id="btnRegi" value="註冊" class="thirdbtn1_green">  
                        <input type="button" id="btnRegiCancel" value="取消" class="thirdbtn2_green">  
                    </td></tr>
                    <tr><td colspan="2" align="center" class="level1">
                        <label for="login_img_control">
                            <span id="to_login_btn">已有會員帳號?</span>
                        </label>
                    </td></tr>
                </table>
            </form>
            <div class="login_block_mid">
                <img src="./pic/commom/mid_pic.svg" alt="登入頁照片">
            </div>
        </div>
    </div>
</div>
    <!-- 燈箱結束 -->
        <section class="section1 bgcColor">
            <div class="wrap">
                <div class="level11 green1">
                    揪團露營
                </div>
                <div class="breadcrumbs">
                    <ul>
                        <li><a href="./shansen.html"  class="level0 green1">首頁</a></li>
                        <li class="level0 gray1">揪團露營</li>
                    </ul>
                </div>
                <div class="report_overlay">
                    <article>
                        <form class="report_form" action="">
                            <div class="level7 bold green1 report_title">檢舉原因</div>                        
                            <div class="report_reason1 level1 gray1">
                                <input type="radio" name="reason0" id="report_equ1">
                                <label for="report_equ1">1</label>
                            </div>
                            <div class="report_reason2 level1 gray1">
                                <input type="radio" name="reason0" id="report_equ2">
                                <label for="report_equ2">2</label>
                            </div>
                            <div class="report_reason3 level1 gray1">
                                <input type="radio" name="reason0" id="report_equ3">
                                <label for="report_equ3">3</label>
                            </div>
                            <div class="report_close_btn">
                                <button type="button" class="thirdbtn1_green submit_btn" id="reportSend">送出</button>
                                <!-- <input class="thirdbtn1_green submit_btn" type="submit" id="reportSend" value="送出"> -->
                                <button type="button" class="thirdbtn2_green btn_modal_close">取消</button>
                            </div>                                        
                        </form>                      
                    </article>
                </div>
                <div class="groupMain">
                    <div class="nav">
                        <a href="#" class="startNewGroup" onclick="startNewGroup()"><button class="mainbtn1">我要開團</button><img src="./pic/group/newgroup-01.svg" alt=""></a>
                        <h2 class="level7 green1">自訂篩選</h2>
                        <div class="serchGroup">
                            <h3 class="level2 green1">選擇地區</h3> 
                            <select class= "gray1 inputstyle" id="loca" onchange="getgroupinfo()">
                                <option class= "gray1" value="0" selected>全部地區</option>
                                <option class= "gray1" value="1">北部</option>
                                <option class= "gray1" value="2">中部</option>
                                <option class= "gray1" value="3">南部</option>
                                <option class= "gray1" value="4">東部</option>
                            </select>
                        </div>
                        <div class="serchGroup">
                            <h3 class="level2 green1">剩餘名額</h3> 
                            <label class= "gray1"><input type="checkbox" value="0" name="people" onchange="getgroupinfo()">1~10人</label>
                            <label class= "gray1"><input type="checkbox" value="1" name="people" onchange="getgroupinfo()">11~20人</label>
                            <label class= "gray1"><input type="checkbox" value="2" name="people" onchange="getgroupinfo()">20人以上</label>
                        </div>
                        <div class="serchGroup">
                            <h3 class="level2 green1">出團日期</h3> 
                            <label class= "gray1"><input type="checkbox" name="date" value="0" onchange="getgroupinfo()">一周內</label>
                            <label class= "gray1"><input type="checkbox" name="date" value="1" onchange="getgroupinfo()">一個月內</label>
                            <label class= "gray1"><input type="checkbox" name="date" value="2" onchange="getgroupinfo()">一個月以上</label>
                        </div>
                    </div>
                    <div class="groups" id="groups">
                    </div>

                </div>
            </div>
        </section>

    <!-- footer 開始-->
    <footer>
    <div class="footer_bgc">
        <div class="wrap">
            <div class="footerarrange">
                <div class="footright">
                    <div class="level2 green1">聯絡資訊 |</div>
                    <div class="level0 green1">
                        電子信箱|ShanSen@gmail.com<br>
                        營業時間|週二至週日 10:00~20:00(國定假日休假)
                    </div>
                </div>
                <div class="footercenter">
                    <a href="./shansen.html">
                        <img src="./pic/commom/pc_header.svg">
                    </a>
                </div>
                <div class="footerright">
                    <div class="link">
                        <div class="level2 green1">相關連結 |</div>
                        <div class="footer_icon">
                            <img src="./pic/commom/foot_line.svg" alt="">
                            <img src="./pic/commom/foot_ig.svg" alt="">
                            <img src="./pic/commom/foot_fb.svg" alt="">
                            <img src="./pic/commom/foot_email.svg" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="copyright">Copyright &copy; 2020ShanSen</div>
</footer>
    <!-- footer 結束-->
    </div>
    <script src="./js/logintext.js"></script>
    <script src="./js/normalFunc.js"></script>
    <!-- 載入資料 -->
    <script>
        //參團
        setTimeout(function(){
            var joinGroup = document.querySelectorAll(".joinGroup");
            for(let i =0; i<joinGroup.length; i++){
                joinGroup[i].addEventListener("click", function(){
                    if(member.MEMNO){
                        var groupNO = $id(`groupNO${i}`).value;
                        var joinxhr = new XMLHttpRequest();
                        joinxhr.onload=function (){
                            if( joinxhr.status == 200 ){
                               reason= JSON.parse(joinxhr.responseText);
                            //    swal(reason);
                               if(reason==="報名成功"){
                                    show=groupsdata[i].團名;
                                    swal(show);
                                    
                               }else{
                                   swal("已報名");
                               }
                            }else{
                                alert(joinxhr.responseText);
                            }
                        }
                        var url = `./php/group/joinGroup.php?GROUP_NO=${groupNO}&MEMNO=${member.MEMNO}`;
                        joinxhr.open("Get", url, true);
                        joinxhr.send( null );

                    }else{
                        showLoginForm();
                    }
                    
                });
            }
        },500);
        
        getgroupinfo();
        function getEQU(i){
            let equthing = document.getElementById(`equthing${i}`);
            if(equdata == "沒資料"){
                let div = $create("div");
                div.innerText = "此團無須自備設備";
                div.style.fontSize ="16px";
                $append(equthing,div);
            }else{
                let div = $create("div");
                $append(equthing,div);
                let a;
                for(let j=0; j<equdata.length ; j++){
                    a=$create("a");
                    a.className="equ";
                    a.innerHTML = ` <button class="tagbtn_yellow">${equdata[j].設備類別名稱}</button>`;
                    $append(div,a);
                }
                let p = $create("p");
                p.className = "gray2";
                p.innerText = "(標籤可到設備交換區)"
                $append(equthing,p);
                
            }
        }
        function findEQU(i,equs){
            let EQUsxhr = new XMLHttpRequest();
            EQUsxhr.onload = function(){
                if(EQUsxhr.status == 200){ //success
                    equdata = JSON.parse(EQUsxhr.responseText);  
                    getEQU(i);
                }else{ //error
                    alert(EQUsxhr.status);
                }
            }
            EQUsxhr.open("get", `./php/group/groupUseEqu.php?GROUP_NO=${equs}`, true);
            EQUsxhr.send(null);
        }
        // 最新留言
        function getMSG(i){
            let msg = document.getElementById(`msg${i}`);
            let a = $create("a");
            a.className="third_title";
            a.innerText=`最新留言（目前${msgdata[0].多少留言}則留言)`;
            $append(msg,a);
            if(msgdata[0].多少留言!=0){
                let div = $create("div");
                div.className= "msgInfo";
                div.innerHTML=`<div class="inform_block">
                                    <div class="inform_pic">
                                            <a href="#"><img src="./pic/member/${msgdata[0].會員頭貼}" alt=""></a>
                                    </div>
                                    <div class="inform_text">
                                        <h4><a href="" class="third_title">${msgdata[0].會員暱稱}</a></h4>
                                    </div>                                                                      
                                </div>
                                <div class="level1">
                                    <span>留言:</span>
                                    <p>${msgdata[0].留言內容}</p>
                                </div>
                                <div class="level0">
                                    留言日期:${msgdata[0].留言時間}
                                </div>`;
                $append(msg,div);               
            }
        }
        // 留言
        function findMsg(i,msgs){
            let msgsxhr = new XMLHttpRequest();
            msgsxhr.onload = function(){
                if(msgsxhr.status == 200){ //success
                    msgdata = JSON.parse(msgsxhr.responseText); 
                    getMSG(i);
                           
                }else{ //error
                    alert(msgsxhr.status);
                }
            }
            msgsxhr.open("get", `./php/group/msg.php?GROUP_NO=${msgs}`, true);
            msgsxhr.send(null);
        }
        // 團
        function showAllGroups(groupsdata){
            let groups= document.getElementById("groups");
            groups.innerHTML="";
            console.log(groupsdata);
            if(groupsdata.length == 0){
                groups.innerHTML="<p class='green1 level5' style='text-align: center;'>目前尚無相關露營揪團</p>";
            }else{
                for(let i=0; i < groupsdata.length; i++){
                    let groupBlock, group, hot, p, gLeft,img, maphashtag, inputg,Right,headLine,h6,fieldset,
                    inform_block,inform_pi,inform_text, h4,span, aboutPepole ,right, equthing, a;
                    //團部分
                    groupBlock =  $create("div");
                    groupBlock.className = "groupBlock";
                    $append(groups,groupBlock);
                    group =  $create("div");
                    group.className = "group gray1";
                    $append(groupBlock,group);
                    if(groupsdata[i].收藏數>=5){
                        hot =  $create("div");
                        hot.className = "hot";
                        hot.innerHTML = "<p class='white'>熱門景點</p>"
                        $append(group,hot);
                    }
                    gLeft =  $create("div");
                    gLeft.className = "gLeft";
                    $append(group,gLeft);
                    groupBinImg =  $create("div");
                    groupBinImg.className = "groupBinImg";
                    $append(gLeft,groupBinImg);
                    img =  $create("img");
                    img.src = "./pic/group/"+groupsdata[i].圖片1;
                    $append(groupBinImg,img);
                    maphashtag =  $create("div");
                    maphashtag.className = "maphashtag";
                    $append(gLeft,maphashtag);
                    a= $create("a");
                    a.href="http://localhost/g3-v2/camping.html";
                    a.innerHTML =`<input class="tagbtn_green" type="submit" value="${groupsdata[i].縣市}">`;
                    $append(maphashtag,a);
                    a= $create("a");
                    a.href=`http://localhost/g3-v2/camping2.html?${groupsdata[i].營區編號}`;
                    a.innerHTML =`<input class="tagbtn_green" type="submit" value="${groupsdata[i].營地}">`;
                    $append(maphashtag,a);
                    gRight =  $create("div");
                    gRight.className = "gRight";
                    $append(group,gRight);
                    headLine =  $create("div");
                    headLine.className = "headLine";
                    $append(gRight,headLine);
                    gname =  $create("h3");
                    gname.className = "level7 green1";
                    gname.innerText = groupsdata[i].團名;
                    $append(headLine,gname);
                    smallInfo =  $create("div");
                    smallInfo.className = "smallInfo";
                    $append(headLine,smallInfo);
                    h6 =  $create("h6");
                    h6.className = "level0 gray1";
                    h6.innerText = "開團日期 :" + groupsdata[i].開團日;
                    $append(smallInfo,h6);
                    input =  $create("input");
                    input.type = "hidden";
                    input.id = "groupNO"+i;
                    input.value=groupsdata[i].團編號;
                    $append(smallInfo,input);
                    if(groupsdata[i].檢舉揪團編號 == null){
                        input =  $create("input");
                        input.className = "reportbtngGroup";
                        input.type="submit";
                        input.value="檢舉";
                        $append(smallInfo,input);
                    }else{
                        input =  $create("input");
                        input.className = "reportbtngGroup";
                        input.type="submit";
                        input.disabled = true;
                        input.style.cursor="default";
                        input.style.color='#C4C4C4';
                        input.style["border-color"]="#C4C4C4";
                        input.value="已檢舉";
                        $append(smallInfo,input);
                    }
                    fieldset =  $create("fieldset");
                    fieldset.className = "poster_inform";
                    $append(gRight,fieldset);
                    legend =  $create("legend");
                    legend.className = "level1 green3 poster";
                    legend.innerText = "主揪";
                    $append(fieldset,legend);
                    inform_block =  $create("div");
                    inform_block.className = "inform_block";
                    $append(fieldset,inform_block);
                    inform_pic =  $create("div");
                    inform_pic.className = "inform_pic";
                    $append(inform_block,inform_pic);
                    img =  $create("img");
                    img.src="./pic/member/"+groupsdata[i].會員照片;
                    $append(inform_pic,img);
                    inform_text =  $create("div");
                    inform_text.className = "inform_text";
                    $append(inform_block,inform_text);
                    h4 =  $create("h4");
                    h4.className = "third_title";
                    h4.innerText=groupsdata[i].會員名;
                    $append(inform_text,h4);
                    p =  $create("p");
                    p.className = "info";
                    p.innerHTML = "<span>相關介紹 :</span> "+groupsdata[i].揪團介紹;
                    $append(gRight,p);
                    p =  $create("p");
                    p.innerHTML = "<span>出團日期 :</span> "+groupsdata[i].出發日;
                    $append(gRight,p);
                    p =  $create("p");
                    p.innerHTML = "<span>結束日期 :</span> "+groupsdata[i].回程日;
                    $append(gRight,p);
                    aboutPepole =  $create("div");
                    aboutPepole.className = "aboutPepole";
                    $append(gRight,aboutPepole);
                    p =  $create("p");
                    p.innerHTML = "<span>人數上限 :</span> "+groupsdata[i].人數上限 + "人";
                    $append(aboutPepole,p);
                    right =  $create("div");
                    right.className = "right";
                    right.innerHTML = "<p class='note'>目前只剩"+groupsdata[i].剩餘名額 + "個名額囉~</p>";
                    $append(aboutPepole,right);
                    equthing =  $create("div");
                    equthing.className = "equthing";
                    equthing.id = "equthing"+i;
                    equthing.innerHTML = "<span>須具備設備 :</span>";
                    $append(gRight,equthing);
                    findEQU(i,groupsdata[i].團編號);
                    more =  $create("div");
                    more.className = "more";
                    more.innerHTML = "<input type='submit' class='mainbtn1 joinGroup' value='我要參加'>";              
                    more.innerHTML +=`<a href='./groupInfo.html?GROUP_NO=${groupsdata[i].團編號}'><input type='submit' class='secondbtn1' value='查看詳情'></a>`;
                    $append(group,more);
                    //留言部分
                    div =$create("div");
                    div.className ="msg gray1";
                    div.id = "msg"+i;
                    $append(groupBlock,div);
                    findMsg(i,groupsdata[i].團編號);
                }
            }
        }
        
        function getgroupinfo(){
            let loca=document.getElementById("loca").value;
            let people = document.getElementsByName("people");
            let date = document.getElementsByName("date");
            var peopleChoice =[];
            var dateChoice =[];
            let j=0;
            for(i=0; i< people.length; i++){
                if(people[i].checked){
                    peopleChoice[j] = people[i].value;
                    j++;
                }
            }
            j=0;
            for(i=0; i< date.length; i++){
                if(date[i].checked){
                    dateChoice[j] = date[i].value;
                    j++;
                }
            }      
            let groupsxhr = new XMLHttpRequest();
            groupsxhr.onload = function(){
                if(groupsxhr.status == 200){ //success
                    let groupsdata = JSON.parse(groupsxhr.responseText);
                    showAllGroups(groupsdata);
                    // 檢舉揪團
                    var reportbtngGroup = document.querySelectorAll(".reportbtngGroup");
                    for(let i =0; i<reportbtngGroup.length; i++){
                        // alert(groupsdata[i].檢舉揪團編號);
                        reportbtngGroup[i].addEventListener("click", function(){
                            // alert();
                            if(groupsdata[i].會員編號 == member.MEMNO){
                                swal("您為主揪，無法檢舉自己的團呦\n若想關閉揪團請進入查看詳情");
                            }else{
                                report("reportbtngGroup",this.value,this.previousSibling.value);
                            }
                            
                        });
                    }
                }else{ //error
                    alert(groupsxhr.responseText);
                }
            }
            groupsxhr.open("get", `./php/group/group.php?loca=${loca}&people=${peopleChoice}&date=${dateChoice}`, true);
            groupsxhr.send(null);
        }
    </script>
    <script>
        //燈箱
        $(document).ready(function(){
            $(".btn_modal_close").on("click", function(){
                $(".report_overlay").addClass("-opacity-zero");
                $("input[name=reason0]").each(function(){
                    $(this).prop("checked",false);//把所有的核方框的property都取消勾選
                }); 
                setTimeout(function(){
                    $(".report_overlay").removeClass("-on -opacity-zero");
                }, 1000);
            });
        });
    </script>
</body>
</html>