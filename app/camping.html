<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>營區攻略</title>
    <script src="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.js"></script>
    <script src="./vender/jquery/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.css" />
    <link rel="stylesheet" href="./css/style.css">
    <link rel="shortcut icon" href="./pic/commom/browser.ico">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
</head>
<body>
    @@include('./layout/header.html', { "underline_03": "orange2" })
    <!-- 燈箱開始 -->
    @@include('./layout/login.html')
    <!-- 燈箱結束 -->
    <div class="bgcColor page">

    <section class="section1">
        <div class="wrap">
            <div class="title">營區攻略</div>
            <div class="breadcrumbs">
                <ul>
                    <li><a href="./shansen.html"  class="level0 green1">首頁</a></li>
                    <li class="level0 gray1">營區攻略</li>
                </ul>
            </div>
            <div class="waethermap camping_block">
                <div class="left_side">
                    <div class="sub_title">尋找營區</div>
                    <div class="weather">
                        <!-- 地區搜尋 -->
                        <div class="search_area">
                            <div class="areaselect">
                                <p>
                                    <label class="third_title" for="">選擇地區:</label>
                                    <select class="selectstyle" name="area" id="area" 
                                        onChange="doNewMaster( document.getElementById( 'area' ), 
                                        document.getElementById( 'campSpot' ) );">
                                    </select>
                                </p>
                                <p>
                                    <label class="third_title" for="">選擇營地:</label>
                                    <select class="selectstyle" name="campSpot" id="campSpot" >
                                    </select>
                                </p>
                            </div>
                        </div>
                            
                        <!-- 溫度、降雨、濕度 -->
                        <div class="waetherdetails">
                            <div class="tempnow waether_area">
                                現在氣溫
                                <p id="temperature"></p>
                            </div>
                            <div class="rain waether_area">
                                降雨機率
                                <p id="rain"></p>
                            </div>
                            <div class="humidity waether_area">
                                相對溼度
                                <p id="humidity"></p>
                            </div>
                        </div>
                        <!-- 未來一周預報 -->
                        <div class="forweek">
                            <div class="day1 prediction">
                                <p class="day" id="day1"></p>
                                <p class="temp_pre" id="htday1"></p>
                                <p class="temp_pre" id="ltday1"></p>
                            </div>
                            <div class="day2 prediction">
                                <p class="day" id="day2"></p>
                                <p class="temp_pre" id="htday2"></p>
                                <p class="temp_pre" id="ltday2"></p>
                            </div>
                            <div class="day3 prediction">
                                <p class="day" id="day3"></p>
                                <p class="temp_pre" id="htday3"></p>
                                <p class="temp_pre" id="ltday3"></p>
                            </div>
                            <div class="day4 prediction">
                                <p class="day" id="day4"></p>
                                <p class="temp_pre" id="htday4"></p>
                                <p class="temp_pre" id="ltday4"></p>
                            </div>
                            <div class="day5 prediction">
                                <p class="day" id="day5"></p>
                                <p class="temp_pre" id="htday5"></p>
                                <p class="temp_pre" id="ltday5"></p>
                            </div>
                            <div class="day6 prediction">
                                <p class="day" id="day6"></p>
                                <p class="temp_pre" id="htday6"></p>
                                <p class="temp_pre" id="ltday6"></p>
                            </div>
                            <div class="day7 prediction">
                                <p class="day" id="day7"></p>
                                <p class="temp_pre" id="htday7"></p>
                                <p class="temp_pre" id="ltday7"></p>
                            </div>
                        </div>
    
                        
    
                        <!-- 氣象描述 -->
                        <div class="weather_explanation">
                            <p id="explanation" class="level1"></p><br>
                            <div class="level1">更新時間：<span class="nowTime" id="nowTime"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="map" class="map"></div>
            </div>
        </div>
    </section>

    <section class="section_hot" id="section_hot">
        <div class="wrap">
            <div class="title">熱門營區</div>           
            <div class="camping_block camp_hot">
                <div class="hot">
                    <p class="white">熱門景點</p>
                </div>         
                <div class="popular_area">
                    <div class="area_pic">
                        <img id="hot_camp_img0">
                    </div>
                    <div class="area_info">
                        <div class="sub_title">
                            <a id="hot_camp_link0">
                            <span id="hot_camp_name0"></span>
                            </a>
                            <span class="third_title coll_num">
                                <input type="hidden" id="hot_camp_no0">
                                <img id="campLike0" class="camplike"  src="./pic/icon/like.png">
                                
                            </span>
                        </div>

                        <div class="level1" id="hot_camp_inner0"></div>

                        <div class="third_title lineheight">聯絡資訊</div>
                        <div class="level1" id="hot_camp_address"></div>
                        
                        <div class="third_title lineheight">相關設備</div>
                        <div class="level1" id="hot_camp_facility"></div>
                    </div>
                </div>         
            </div>
        </div>
        <div class="wrap">
            <div class="other_popular_area">
                <div class="card camping_block">
                    <div class="content">
                        <img id="hot_camp_img1">
                        <a id="hot_camp_link1">
                            <span class="camp_sub_title" id="hot_camp_name1"></span>
                        </a>
                        <span>
                            <input type="hidden" id="hot_camp_no1">
                            <img id="campLike1" class="camplike"  src="./pic/icon/like.png">
                        </span>
                        <div class="level1 ellipsis" id="hot_camp_inner1"></div>
                    </div>
                </div>
                <div class="card camping_block">
                    <div class="content">
                        <img id="hot_camp_img2">
                        <a id="hot_camp_link2">
                            <span class="camp_sub_title" id="hot_camp_name2"></span>
                        </a>
                        <span>
                            <input type="hidden" id="hot_camp_no2">
                            <img id="campLike2" class="camplike"  src="./pic/icon/like.png">
                        </span>
                        <div class="level1 ellipsis" id="hot_camp_inner2"></div>
                    </div>
                </div>
                <div class="card camping_block">
                    <div class="content">
                        <img id="hot_camp_img3">
                        <a id="hot_camp_link3">
                            <span class="camp_sub_title" id="hot_camp_name3"></span>
                        </a>
                        <span>
                            <input type="hidden" id="hot_camp_no3">
                            <img id="campLike3"  class="camplike"  src="./pic/icon/like.png">
                        </span>
                        <div class="level1 ellipsis" id="hot_camp_inner3"></div>
                    </div>
                </div>
                <div class="card camping_block">
                    <div class="content">
                        <img id="hot_camp_img4">
                        <a id="hot_camp_link4" href="">
                            <span class="camp_sub_title" id="hot_camp_name4"></span>
                        </a>
                        <span>
                            <input type="hidden" id="hot_camp_no4">
                            <img id="campLike4"  class="camplike"  src="./pic/icon/like.png">

                        </span>
                        <div class="level1 ellipsis" id="hot_camp_inner4"></div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section  class="camppart">
        <div class="wrap">
            <div class="title">近期揪團</div>
            <div class="camping_block currently_gruop">
                <div class="gMainGroups" id="gMainGroups">
                </div>
                <a href="./group.html"><button class="secondbtn1">看更多精選</button></a>
            </div>
        </div>
    </section>
    </div>

<!-- footer 開始-->
@@include('./layout/footer.html')
<!-- footer 結束-->
<script>
function $id(id){
    return document.getElementById(id);
}

function likeRank(){
    var hotspotxhr = new XMLHttpRequest();
        hotspotxhr.onload = function(){
            if( hotspotxhr.status == 200 ){
                showhotspot(hotspotxhr.responseText);
            }else{
            console.log( hotspotxhr.status );
            }
        }
    hotspotxhr.open("Get", "php/camping/camping1.php", true);
    hotspotxhr.send( null );
}

function showhotspot(json){
    hotspotDatas = JSON.parse(json);
    for(let i=0 ; i<5 ; i++){
        // console.log(hotspotDatas[i]);
        let likeID = "hot_camp_name"+i;
        let likeInner = "hot_camp_inner"+i;
        let likeImg = "hot_camp_img"+i;
        let likeLink = "hot_camp_link"+i;
        let likeNo = "hot_camp_no"+i;
        let campLike = "camplike"+i;
        $id(likeID).innerText = hotspotDatas[i].CAM_NAME;
        $id(likeInner).innerText = hotspotDatas[i].CAM_INTRODUCTION;
        $id(likeImg).src = `./pic/camping/camping_spot_img/${hotspotDatas[i].CAM_PIC1}.jpg`;
        $id(likeLink).href=`camping2.html?${hotspotDatas[i].CAM_NO}`;
        $id(likeNo).value = hotspotDatas[i].CAM_NO;
        var CAM_NUM = $id(likeNo).value;
        checkheart(CAM_NUM,i);
        
    }
    $id('hot_camp_address').innerText = hotspotDatas[0].CAM_ADDRESS;
    $id('hot_camp_facility').innerText = hotspotDatas[0].CAM_FACILITY;
    $id('coll_num').innerText = hotspotDatas[0].收藏數;
}

function checkheart(CAM_NUM,i){  
    var xhr1 = new XMLHttpRequest();
    xhr1.onload = function(){
        if (xhr1.status == 200) { //連線成功
            let campLike = "camplike"+i;
            let confirmlike = xhr1.responseText;
            // console.log(confirmlike);
            let objs = document.getElementsByClassName("camplike");
            // console.log("length : ", objs.length)
            if(confirmlike==='有收藏'){
                // $id(campLike).src="./pic/icon/like_check.png";
                objs[i].setAttribute('src','./pic/icon/like_check.png');
            }else{
                // $id(campLike).src="./pic/icon/like.png";
                objs[i].src="./pic/icon/like.png";
            }
        } else {
            // alert(xhr1.status);
            // alert('還沒登入無法判斷愛心');
        }
    }
    xhr1.open("post","php/camping/ifliked1.php", true);
    xhr1.setRequestHeader("content-type", "application/x-www-form-urlencoded")
    let data = `CAM_NO=${CAM_NUM}`;
    xhr1.send(data);
}

let like = document.querySelectorAll('.camplike');
// alert(like.length);
for(let i=0;i<like.length;i++){
    like[i].addEventListener('click',function(){
        let likeNo = $id(`hot_camp_no${i}`).value;
        // alert(likeNo);
        if (member.MEM_ID) {
        var changexhr = new XMLHttpRequest();
        changexhr.onload = function(e) {
            if (changexhr.status == 200) { //連線成功
                console.log(changexhr.responseText);
                let confirmlike = changexhr.responseText;
                let campLike = "campLike"+i;
                console.log(campLike);
                if(confirmlike==='有收藏'){
                    $id(campLike).src="./pic/icon/like_check.png";
                    // $id('coll_num').innerText = parseInt(hotspotDatas[0].收藏數) + 1;
                }else{
                    $id(campLike).src="./pic/icon/like.png";
                    // $id('coll_num').innerText = parseInt(hotspotDatas[0].收藏數) - 1;
                }
            } else {
                alert(changexhr.status);
            }
            
        }
            var url = "php/camping/changelike.php";
            changexhr.open("post", url, true);
            changexhr.setRequestHeader("content-type", "application/x-www-form-urlencoded")
            let data = `CAM_NO=${likeNo}`;
            changexhr.send(data);
        } else {
            //沒有登入，請先登入
            swal('請先登入');
        }

    })
}

function getMemberInfo_forcamp(callback){
    let xhr = new XMLHttpRequest();
    xhr.onload = function(){
        callback();
        if(xhr.status == 200){ //success
            member = JSON.parse(xhr.responseText);
            if(member.MEM_ID){
                $id("header_memName").innerText = member.MEM_NICKNAME
                $id('spanLogin').innerHTML = '登出';
                console.log(member);         
            }
        }else{ //error
            alert(xhr.status);
        }
    }
    xhr.open("get", "php/common/getMemberInfo.php", true);
    xhr.send(null);
}


window.addEventListener('load',function (){
    getMemberInfo_forcamp(likeRank);
},false);
</script>


<script src="./js/logintext.js"></script>
<script src="https://unpkg.com/jquery"></script>
<script src="./js/map.js"></script>
<script src="./js/main.js"></script>
<script src="./js/weather.js"></script>
<script src="./js/currentlygroup.js"></script>



</body>
</html>