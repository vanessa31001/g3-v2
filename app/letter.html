<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>明信片</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.12/vue.js"></script> 
    <script src="./vender/jquery/jquery-3.5.1.min.js"></script>
    <script src="./js/main.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="./vender/canvas/html2canvas.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="shortcut icon" href="./pic/commom/browser.ico">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- header開始-->
    @@include('./layout/header.html', { "underline_04": "orange2" })
    <!-- 燈箱開始 -->
    @@include('./layout/login.html')
    <!-- 燈箱結束 -->
    <section class="section1 bgcColor">
        <div class="wrap posWrap">
            <div class="stepBreadcrumbs">
                <div class="cardStepContent">
                    <div class="cardStep" id="cardStep1">
                        <p>1</p>
                    </div>
                    <p class="level4 cardStepTitle cardStepTitle1 " id="cardStepId1">選擇材質</p>
                </div>
                <div class="stepLine" id="stepLine1">

                </div>
                <div class="cardStepContent">    
                    <div class="cardStep" id="cardStep2">
                        <p>2</p>
                    </div>
                    <p class="level4 cardStepTitle" id="cardStepId2">上傳照片</p>
                </div>
                <div class="stepLine" id="stepLine2">
                    
                </div>
                <div class="cardStepContent">
                    <div class="cardStep" id="cardStep3">
                        <p>3</p>
                    </div>
                    <p class="level4 cardStepTitle" id="cardStepId3">增加插圖</p>
                </div>
                <div class="stepLine" id="stepLine3">
                    
                </div>
                <div class="cardStepContent">
                    <div class="cardStep" id="cardStep4">
                        <p>4</p>
                    </div>
                    <p class="level4 cardStepTitle" id="cardStepId4">輸入內文 </p>
                </div>
                <div class="stepLine" id="stepLine4">
                    
                </div>
                <div class="cardStepContent">
                    <div class="cardStep" id="cardStep5">
                        <p>5</p>
                    </div>
                    <p class="level4 cardStepTitle" id="cardStepId5">寄給朋友</p>
                </div>
                <div class="stepLine" id="stepLine5">
                    
                </div>
                <div class="cardStepContent">
                    <div class="cardStep" id="cardStep6">
                        <p>6</p>
                    </div>
                    <p class="level4 cardStepTitle" id="cardStepId6">下載留存</p>
                </div>
                
            </div>
            <div class="postcard_content">
                
                <div class="postcardLeftAll" id="canv">
                    <div class="postcard " id="postcard1Id">
                        <div class="pdContentImg">
                            <img class="postcardLogo" src="./pic/postcardMaterial/LOGO/logoUse.png" style="width: 100%">
                        </div>
                        <div class="putPhoto">
                            <img id="postcardPhotoPut">
                        </div>
                    </div>
                    <div class="postcard2 " id="postcard2Id">
                        <div class="posOutsideContent">
                            <div class="postcardContent" id="posContentLeft">
                                <p class="postContLeftWord" id="postcardLeftWord1"></p>
                                <p class="postContLeftWord" id="postcardLeftWord2"></p>
                                <p class="postContLeftWord" id="postcardLeftWord3"></p>
                                <p class="postContLeftWord" id="postcardLeftWord4"></p>
                                <p class="postContLeftWord" id="postcardLeftWord5"></p>
                            </div>
                            <div class="postcardContent" id="posContentRight">
                                <p id="testLeftWordLimit"></p>
                                <p id="testLeftWordLimit2"></p>
                                <p id="testLeftWordLimit3"></p>
                                <p id="testLeftWordLimit4"></p>
                                <p id="testLeftWordLimit5"></p>
                                <p id="testLeftWordLimit6"></p>
                                <div class="posFromTo">
                                    <p class="posFromToText level5" id="posFrom">From:</p>
                                    <p class="posFromToText level5" id="posTo">To:</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="rightPostcard">
                    <div class="rightPostcard_aside">
                        <p class="level4 topStepText" id="stepTitleName">選擇材質|選擇照片|增加插圖|傳遞心情|填寫收件人|下載留存</p>
                        <div class="stylePostcard" id="rightStep1">                            
                            <div class="paperTexture">
                                <p>皺褶灰白</p>
                                <div class='posBackground'>
                                    <div class="postcardPaper" id="paper1"></div>
                                </div>
                            </div>
                            
                            <div class="paperTexture">
                                <p>淡點米黃</p>
                                <div class='posBackground'>
                                    <div class="postcardPaper" id="paper2"></div>
                                    
                                </div>
                            </div>
                            
                            <div class="paperTexture">
                                <p>格線粉紅</p>
                                <div class='posBackground'>
                                    <div class="postcardPaper" id="paper3"></div>
                                    
                                </div>
                            </div>
                        </div>
                        <div class="stylePostcard" id="rightStep2">
                            <div class="photoChoose">
                                <img class="postPhoto" src="./pic/postcardMaterial/presetPhoto/postcardPhoto1.jpg" id="postcardPhoto1">
                            </div>
                            <div class="photoChoose">
                                <img class="postPhoto" src="./pic/postcardMaterial/presetPhoto/postcardPhoto2.jpg" id="postcardPhoto2">
                            </div>
                            <div class="photoChoose">
                                <img class="postPhoto" src="./pic/postcardMaterial/presetPhoto/postcardPhoto3.jpg" id="postcardPhoto3">
                            </div>
                            <div class="photoChoose">
                                <img class="postPhoto" src="./pic/postcardMaterial/presetPhoto/postcardPhoto4.jpg" id="postcardPhoto4">
                            </div>
                            <div class="photoChoose">
                                <img class="postPhoto" src="./pic/postcardMaterial/presetPhoto/postcardPhoto5.jpg" id="postcardPhoto5">
                            </div>
                            <label class="photoUpdate1">
                                <input type="file" id="upPhoto1" >
                                <img class="updatePicPos" id="updatePhotoHere" src="./pic/postcardMaterial/updatePicPos.svg">
                            </label>
                        </div>
                        <div class="stylePostcard" id="rightStep3">
                            <input type="text" id="postcardArray" value="">
                            <div class="posLittlePic" >
                                <img id="LittlePic1" src="./pic/postcardMaterial/littlePic/LittlePic1.svg">
                            </div>
                            <div class="posLittlePic">
                                <img id="LittlePic2" src="./pic/postcardMaterial/littlePic/LittlePic2.svg">
                            </div>
                            <div class="posLittlePic">
                                <img id="LittlePic3" src="./pic/postcardMaterial/littlePic/LittlePic3.svg">
                            </div>
                            <div class="posLittlePic">
                                <img id="LittlePic4" src="./pic/postcardMaterial/littlePic/LittlePic4.svg">
                            </div>
                            <div class="posLittlePic">
                                <img id="LittlePic5" src="./pic/postcardMaterial/littlePic/LittlePic5.svg">
                            </div>
                            <div class="posLittlePic">
                                <img id="LittlePic6" src="./pic/postcardMaterial/littlePic/LittlePic6.svg">
                            </div>
                            <div class="posLittlePic">
                                <img id="LittlePic7" src="./pic/postcardMaterial/littlePic/LittlePic7.svg">
                            </div>
                            <div class="posLittlePic">
                                <img id="LittlePic8" src="./pic/postcardMaterial/littlePic/LittlePic8.svg">
                            </div>
                        </div>
                        <div class="stylePostcard" id="rightStep4">
                            <div class="step4TopContent">
                                <textarea  id="postcardInsideText" rows="11" cols="27" placeholder="請在這裡輸入內文"></textarea>
                            </div>
                            <div class="postcardWordCreate">
                                <div class="posColorTitle">
                                    文字顏色
                                </div>
                                <div class="ColorAndCreate">
                                    <div class="posWordColor" id="posWordBlue">
                                    
                                    </div>
                                    <div class="posWordColor" id="posWordOrange">

                                    </div>
                                    
                                    <div class="posWordColor" id="posWordYellow">

                                    </div>
                                    <div class="posWordColor" id="posWordGray">

                                    </div>
                                    <div class="posWordColor" id="posWordBlack">

                                    </div>
                                    
                                </div>
                                <div class="posButtonCorD">
                                    <button class="thirdbtn2_green" id='createWordFromTo'>
                                        生成文字
                                    </button>
                                    <button class="thirdbtn2_orange" id="deleteWordFromTo">
                                        清除文字
                                    </button>
                                </div>
                                <p id="posWarningSign">
                                    不好意思，您寫的內容超過可容納範圍，可點選清除開始重新填寫。
                                </p>
                            </div>
                        </div>
                        <div class="stylePostcard" id="rightStep5">
                            <div class="colorBig">
                                <p class="posFromToTitle">填寫收件人</p>
                                <input type="text" class="posWriteFromTo" id="writeFrom"></input>
                                <div class="toColorTitle">
                                    收件人文字顏色
                                </div>
                                <div class="fromToColor">
                                    <div class="fromWordColor" id="fromWordBlue">
                                    
                                    </div>
                                    <div class="fromWordColor" id="fromWordOrange">

                                    </div>
                                    
                                    <div class="fromWordColor" id="fromWordYellow">

                                    </div>
                                    <div class="fromWordColor" id="fromWordGray">

                                    </div>
                                    <div class="fromWordColor" id="fromWordBlack">

                                    </div>
                                </div>
                            </div>
                            <div class="colorBig1">        
                                <p class="posFromToTitle">填寫寄件人</p>
                                <input type="text" class="posWriteFromTo" id="writeTo"></input>
                                <div class="fromColorTitle">
                                    寄件人文字顏色
                                </div>
                                <div class="fromToColor">
                                    <div class="toWordColor" id="toWordBlue">
                                    
                                    </div>
                                    <div class="toWordColor" id="toWordOrange">

                                    </div>
                                    
                                    <div class="toWordColor" id="toWordYellow">

                                    </div>
                                    <div class="toWordColor" id="toWordGray">

                                    </div>
                                    <div class="toWordColor" id="toWordBlack">

                                    </div>
                                    
                                </div>
                            </div>
                            <div class="posButtonSend">
                                <button class="thirdbtn2_green" id='posSendFromTo'>
                                    確認送出
                                </button>
                                <button class="thirdbtn2_orange" id="posDelFromTo">
                                    重新填寫
                                </button>
                            </div>    
                        </div>
                        <div class="stylePostcard" id="rightStep6">
                            <div class="posButtonContentBack">
                                <button class="thirdbtn2_green" id="downloadBack">
                                    下載背面
                                </button>
                            </div>
                            <div class="posButtonContentFront">
                                <button class="thirdbtn2_green" id="downloadFront">
                                    下載封面
                                </button>
                            </div>
                        </div>
                        <div class="stepContent">
                            <button class="thirdbtn2_green" id="previousStep" >上一步</button>
                            <button class="thirdbtn2_green" id="nextStep" >下一步</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- footer 開始-->
    @@include('./layout/footer.html')
    <!-- footer 結束-->

    <script>
        function doFirst(){
            //建立變數
            let stepTitleSelect = document.getElementById('stepTitleName');
            let previousStep = document.getElementById('previousStep');
            let nextStep = document.getElementById('nextStep');
            let stepTitle = stepTitleSelect.innerText.split('|');  //利用split生成標題陣列
            let stepControl = 0;  //步驟控制器
            let firstStepText = stepTitle[stepControl];  //第一步標題
            let firstRightContent = document.getElementById('rightStep1');
            let contentList = document.querySelectorAll('.stylePostcard');
            let paper1 = document.getElementById('paper1');
            let paper2 = document.getElementById('paper2');
            let paper3 = document.getElementById('paper3');
            let paperList = document.querySelectorAll('.postcardPaper');
            let postPhotoList = document.querySelectorAll('.postPhoto');
            let postcardPhotoPut = document.getElementById('postcardPhotoPut');  //放置PHOTO的img標籤的ID
            let updatePhotoHere =document.getElementById('upPhoto1');  //input的ID
            let postcard1Id = document.getElementById('postcard1Id');
            let postcard2Id = document.getElementById('postcard2Id');
            let posLittlePicList =  document.querySelectorAll('.posLittlePic');
            let littlePicIdCount = 0; 
            let dragArray = [];       //用來紀錄create小物件的ID,為了建立物件的事件聆聽
            let posWordColorList = document.querySelectorAll('.posWordColor');
            let createWordFromTo = document.getElementById('createWordFromTo');
            let wordColor = "rgb(0, 165, 163)";     //預設點選文字方塊的顏色
            let clickTimeOfWord =0;  //計算點擊送出文字次數
            let deleteWordFromTo = document.getElementById('deleteWordFromTo');
            let testLeftWordLimit = document.getElementById('testLeftWordLimit');
            let testLeftWordLimit2 = document.getElementById('testLeftWordLimit2');
            let testLeftWordLimit3 = document.getElementById('testLeftWordLimit3');
            let testLeftWordLimit4 = document.getElementById('testLeftWordLimit4');
            let testLeftWordLimit5 = document.getElementById('testLeftWordLimit5');
            let testLeftWordLimit6 = document.getElementById('testLeftWordLimit6');
            let posSendFromTo = document.getElementById('posSendFromTo');
            let fromWordColorList = document.getElementsByClassName('fromWordColor');
            let fromWordColorVar = "#FC8F24";
            let toWordColorList = document.getElementsByClassName('toWordColor');
            let toWordColorVar = "#FC8F24";
            let posDelFromTo = document.getElementById('posDelFromTo');
            let postcard_content = document.getElementsByClassName('postcard_content')[0];
            let downloadBack = document.getElementById('downloadBack');
            let downloadFront = document.getElementById('downloadFront');
            let paperBackgroundNow = 'url("./pic/postcardMaterial/paper/paper1.png")';
            
            
            //預設內容
            firstRightContent.style.display ='block';
            stepTitleSelect.innerText = firstStepText;
            previousStep.classList.remove('thirdbtn2_green');
            previousStep.setAttribute("style","background-color: #FFFFFF; color: #00A5A3; padding: 0 15px;  height: 35px; font-size: 16px; border-radius: 8px; border-color: #00A5A3;  border-width:2px; font-weight: bold;");
            document.getElementById(`cardStep${stepControl+1}`).className = "chooseCardStep";   
    
    
            
            
    
            //建立事件玲聽
            previousStep.addEventListener('click',changeStepBack);   //點擊事件換上一步
            nextStep.addEventListener('click',changeStepNext);       //點擊事件換下一步
            updatePhotoHere.addEventListener('change',PhotoPut);   //建立事件聆聽，偵測input發生change事件，執行PhotoPut函數
            createWordFromTo.addEventListener('click', newWordNow);   //點擊事件產生文字
            deleteWordFromTo.addEventListener('click',delWordNow);
            posSendFromTo.addEventListener('click',sendFromToJs);
            posDelFromTo.addEventListener('click',posDelFromToJs);
            downloadBack.addEventListener('click',function(){
                let downloadId = 'canv';
                downloadPostcardFunc(downloadId);
            });
            downloadFront.addEventListener('click',function(){
                let downloadId = 'canv1';
                downloadPostcardFunc(downloadId);
            });
            for(let i =0; i<paperList.length; i++){                   //建立材質的事件聆聽
                paperList[i].addEventListener('click',function(){     
                    let paperPassId = this.id;        //抓取材質ID
                    paperBackground(paperPassId);
                });
            }
            for(let i =0; i<postPhotoList.length; i++){
                postPhotoList[i].addEventListener('click',function(){
                    let photoPassId = this.id;
                    photoChange(photoPassId);
                });
            }
            for(let i=0; i<posLittlePicList.length; i++){
                posLittlePicList[i].addEventListener('click',function(){
                    let posLittlePicId = posLittlePicList[i].getElementsByTagName('img')[0].id;
                    createPic(posLittlePicId);
                });
            }
            for(let i=0;i<posWordColorList.length; i++){
                posWordColorList[i].addEventListener('click',function(){
                    let posWordColorId = this.id;
                    posWordColorChange(posWordColorId);
                });
            }
            for(let i=0; i<fromWordColorList.length; i++){
                fromWordColorList[i].addEventListener('click',function(){
                    let fromWordColorId = this.id;
                    fromColorChange(fromWordColorId);
                });
            }
            for(let i=0; i<toWordColorList.length; i++){
                toWordColorList[i].addEventListener('click',function(){
                    let toWordColorId = this.id;
                    toColorChange(toWordColorId);
                });
            }
            
            //函式區
            function changeStepBack(){
                stepControl-=1;
                if(stepControl==0){
                    previousStep.setAttribute("style","background-color: #FFFFFF; color: #00A5A3; padding: 0 15px;  height: 35px; font-size: 16px; border-radius: 8px; border-color: #00A5A3;  border-width:2px; font-weight: bold;");
                    previousStep.classList.remove('thirdbtn2_green');
                    let nowStepNum = stepTitle.indexOf(stepTitleSelect.innerText);
                    let nowRightNum =  nowStepNum+1;  //抓ID用
                    document.getElementById(`rightStep${nowRightNum}`).style.display = 'none';
                    stepTitleSelect.innerText =stepTitle[stepControl];
                    document.getElementById(`rightStep${nowRightNum-1}`).style.display = 'block';
                    document.getElementById(`cardStep${nowRightNum}`).className = "cardStep";
                    document.getElementById(`cardStep${nowRightNum-1}`).className = "chooseCardStep";
                    document.getElementById(`stepLine${nowRightNum-1}`).style.borderTopColor = '#C4C4C4';
                    document.getElementById(`cardStepId${nowRightNum}`).classList.remove('cardStepTitle1');
                    document.getElementById(`cardStepId${nowRightNum-1}`).classList.add('cardStepTitle1');
                    document.getElementById(`cardStepId${nowRightNum-1}`).classList.remove('cardStepTitleHistory');
                }else if(stepControl>0){
                    
                    let nowStepNum = stepTitle.indexOf(stepTitleSelect.innerText);
                    let nowRightNum =  nowStepNum+1; //抓ID用
                    document.getElementById(`rightStep${nowRightNum}`).style.display = 'none';
                    document.getElementById(`cardStep${nowRightNum}`).className = "cardStep";
                    stepTitleSelect.innerText =stepTitle[stepControl];
                    document.getElementById(`rightStep${nowRightNum-1}`).style.display = 'block';
                    document.getElementById(`cardStep${nowRightNum-1}`).className = "chooseCardStep";
                    document.getElementById(`stepLine${nowRightNum-1}`).style.borderTopColor = '#C4C4C4';
                    document.getElementById(`cardStepId${nowRightNum}`).classList.remove('cardStepTitle1');
                    document.getElementById(`cardStepId${nowRightNum-1}`).classList.add('cardStepTitle1');
                    document.getElementById(`cardStepId${nowRightNum-1}`).classList.remove('cardStepTitleHistory');
                    
                    styleDisplayPre(stepTitleSelect.innerText);  //傳上一個標題文字給函數
                }else if(stepControl<0){
                    stepControl+=1;
                }
            }
            function changeStepNext(){
                stepControl+=1;
                let nowStepNum = stepTitle.indexOf(stepTitleSelect.innerText);
                let nowRightNum =  nowStepNum+1; //抓ID用
                if(stepTitle.length>stepControl>0){
    
                    previousStep.removeAttribute('style');
                    previousStep.classList.add('thirdbtn2_green');
                    if(nowStepNum<stepTitle.length-1){
                        document.getElementById(`rightStep${nowRightNum}`).style.display = 'none';
                        document.getElementById(`cardStep${nowRightNum}`).className = "chooseCardStep";
                        document.getElementById(`stepLine${nowRightNum}`).style.borderTopColor = '#FFAE08';
                        stepTitleSelect.innerText =stepTitle[stepControl];
                        document.getElementById(`rightStep${nowRightNum+1}`).style.display = 'block';
                        document.getElementById(`cardStep${nowRightNum+1}`).className = "chooseCardStep";
                        document.getElementById(`cardStepId${nowRightNum}`).classList.remove('cardStepTitle1');
                        document.getElementById(`cardStepId${nowRightNum}`).classList.add('cardStepTitleHistory');
                        document.getElementById(`cardStepId${nowRightNum+1}`).classList.add('cardStepTitle1');
                        styleDisplayNext(stepTitleSelect.innerText);   //傳下一個標題文字給函數
                    }
                }else{
                    stepControl -=1;   //>=6 做-1 預防超過length
                }
            }
            function paperBackground(paperNowId){
                    for(let j =1;j<=3;j++){
                        document.getElementById(`paper${j}`).style.borderColor = "rgba(255, 0, 0, 0)";
                    }
                    document.getElementById(paperNowId).style.borderColor ="rgba(255, 0, 0, 0.4)";
                    document.getElementsByClassName('postcard')[0].style.backgroundImage = `url("./pic/postcardMaterial/paper/${paperNowId}.png")`;
                    paperBackgroundNow = `url("./pic/postcardMaterial/paper/${paperNowId}.png")`;
                    document.getElementsByClassName('pdContentImg')[0].style.display = "block";
                    document.getElementsByClassName('pdContentImg')[0].style.backgroundImage =`url("./pic/postcardMaterial/paper/${paperNowId}.png")`;
                
            }
            function photoChange(photoId){
                for(let j =1;j<=postPhotoList.length;j++){
                    
                    document.getElementById(`postcardPhoto${j}`).style.borderColor ="rgba(0, 0, 255, 0)";  //重置Border透明度
                }
                document.getElementById(photoId).style.borderColor ="rgba(0, 0, 255, 0.4)";
                document.getElementsByClassName('putPhoto')[0].style.backgroundImage = `url("./pic/postcardMaterial/presetPhoto/${photoId}.jpg")`;
            }
            function PhotoPut(){
            let putPhotoFrom = updatePhotoHere.files[0];     //抓input內的FILE資訊為FILES陣列中的第一個
            let readPhoto = new FileReader();       //將FileReader物件命名
            readPhoto.readAsDataURL(putPhotoFrom);    //使用FileReader的物件方法
            readPhoto.addEventListener('load',function(e){    //建立事件聆聽 等待讀到檔案，LOAD事件發生執行function
                postcardPhotoPut.src = readPhoto.result;   //結果放入img標籤的src
                postcardPhotoPut.style.width = '100%';   //設定寬
                postcardPhotoPut.style.height = '100%';  //設定高
            });
    
            }
            function styleDisplayNext(posTextTitle){
                if(posTextTitle=="增加插圖"){
                    postcard1Id.classList.remove('postcard');
                    postcard1Id.classList.add('leftPostcard1');
                    postcard2Id.classList.remove('postcard2');
                    postcard2Id.classList.add('leftPostcard2');
                    document.getElementsByClassName('leftPostcard2')[0].style.backgroundImage = paperBackgroundNow;
                    
                }else if(posTextTitle=="下載留存"){
                    let postcardLeftAll = document.getElementsByClassName('postcardLeftAll')[0].cloneNode(true);
                    postcardLeftAll.style.display = 'block';
                    postcardLeftAll.id = 'canv1';
                    postcardLeftAll.childNodes[1].classList.add('postcard');
                    postcardLeftAll.childNodes[1].style.display = 'block';
                    postcardLeftAll.childNodes[3].style.display = 'none';
                    insertAfter(postcardLeftAll,document.getElementsByClassName('rightPostcard')[0]);
                    let posCover = document.createElement('p');
                    posCover.classList.add('level4','posCover');
                    posCover.innerText = '背面';
                    posCover.display = 'block';
                    document.getElementsByClassName('posWrap')[0].insertBefore(posCover,postcard_content);
                    let posBack = document.createElement('p');
                    posBack.classList.add('level4','posCover');
                    posBack.innerText = '封面';
                    posBack.display = 'block';
                    posBack.style.flex="100%";
                    posBack.id = 'posBackId';
                    insertAfter(posBack,document.getElementsByClassName('rightPostcard')[0]);
                    nextStep.style.display = 'none';
                }
            }
            function styleDisplayPre(posTextTitle){
                
                if(posTextTitle =='選擇照片'){
                    postcard1Id.classList.remove('leftPostcard1');
                    postcard1Id.classList.add('postcard');
                    postcard2Id.classList.remove('leftPostcard2');
                    postcard2Id.classList.add('postcard2');
                }else if(posTextTitle =='填寫收件人'){
                    document.getElementsByClassName('postcardLeftAll')[1].remove();
                    document.getElementsByClassName('posCover')[0].remove();
                    document.getElementById('posBackId').remove();
                    nextStep.style.display = 'block';
                }
            }
            function createPic(littlePicId){
                littlePicIdCount+=1;
                let leftPostcardIcon = document.createElement('img');
                leftPostcardIcon.setAttribute('id',`left${littlePicId+littlePicIdCount}`);
                leftPostcardIcon.src = `./pic/postcardMaterial/littlePic/${littlePicId}.svg`;
                leftPostcardIcon.classList.add('leftPostcardIconClass');
                leftPostcardIcon.style.width = "100px";
                leftPostcardIcon.style.height = '100px';
                leftPostcardIcon.style.position = 'absolute';
                leftPostcardIcon.style.left = "0";
                leftPostcardIcon.style.top = '0';
                leftPostcardIcon.draggable = "true";
                leftPostcardIcon.style.cursor = 'grab';
    
                document.getElementById('postcard2Id').appendChild(leftPostcardIcon);
                leftPostcardIconId = leftPostcardIcon.id;
                dragArray.push(leftPostcardIconId);   //陣列測試
                document.getElementById('postcardArray').value = dragArray;
                for(let i = 0; i<dragArray.length;i++){
                
                document.getElementById(`${dragArray[i]}`).addEventListener('dragstart',e=>{
                    e.dataTransfer.setData(`image${i}`,
                    (parseInt( window.getComputedStyle(e.target).getPropertyValue('left')) - e.clientX) + ',' + (parseInt( window.getComputedStyle(e.target).getPropertyValue('top'))-e.clientY));   //計算物件本身位置最左處到指標目前位置的距離，與物件本身位置最高處到指標目前位置的距離
                    
                });
                postcard2Id.addEventListener("dragover", e => {
                    e.preventDefault();
                });
                postcard2Id.addEventListener("drop", e=>{
                    let offset = e.dataTransfer.getData(`image${i}`).split(',');
                    document.getElementById(`${dragArray[i]}`).style.left = (e.clientX + parseInt(offset[0])) + 'px';
                    document.getElementById(`${dragArray[i]}`).style.top = (e.clientY + parseInt(offset[1])) + 'px';
                    e.preventDefault();
                    });
                }
            }
            function posWordColorChange(posWordColorId){
                for(let i =0; i<posWordColorList.length;i++){
                    posWordColorList[i].style.borderColor = "rgba(0, 0, 0, 0)";    //重置顏色方塊的border轉為透明
                }
                document.getElementById(`${posWordColorId}`).style.borderColor ="rgba(255, 0, 0, 0.4)";    //將點擊的border顏色改變
                wordColor = window.getComputedStyle(document.getElementById(`${posWordColorId}`)).getPropertyValue('background-color');  //將點擊的顏色背景輸入到全域的變數，方便其他函數做使用。
            }
            function newWordNow(){
                let InsideWord = document.getElementById('postcardInsideText').value;
                if(InsideWord == ''){
                    
                }else{
                    clickTimeOfWord+=1;
                    if(clickTimeOfWord<=5){    //點擊次數小於五次做
                        document.getElementById('posWarningSign').style.visibility = 'hidden';   //警告標語不顯示
                        let textValue = document.getElementById('postcardInsideText').value;  //抓textarea內的值
                        testLeftWordLimit.innerText =textValue;   //測試文字框
                        if(document.getElementById('postcardLeftWord1').clientWidth-15>testLeftWordLimit.clientWidth){   //測試文字框的寬度若小於底線的寬度做
                            document.getElementById(`postcardLeftWord${clickTimeOfWord}`).innerText = textValue;      //根據點擊次數判斷寫入哪個P
                            document.getElementById(`postcardLeftWord${clickTimeOfWord}`).style.color = wordColor;    //根據文字選擇顏色更改文字顏色
                            document.getElementById('postcardInsideText').value = '';   //按下輸入後清空textarea
                        }else{   //測試文字框的寬度若大於底線的寬度
                            let i=0;      //總字數
                            let j= 0;     //第一行的字數 (若超過第一行，j則為第一行的最大容納字數)
                            let k =0;     //第二行的字數 (若超過第二行，k則為第二行的最大容納字數)
                            let l =0;     //第三行的字數 (若超過第三行，l則為第三行的最大容納字數)
                            let m =0;     //第四行的字數 (若超過第四行，m則為第二行的最大容納字數)
                            let n =0;     //第五行的字數 (若超過第五行，n則為第五行的最大容納字數)
                            
                            while(textValue.substring(0,i).length<textValue.length){   //當子字串的長度小於總長度時做
                                testLeftWordLimit2.innerText =  textValue.substring(0,j);  //加入子字串從0到j進入測試文字中
                                i++;
                                if( document.getElementById('postcardLeftWord1').clientWidth-15>testLeftWordLimit2.clientWidth){    //若測試文字行數的寬度小於底線文字寬度做
                                    j++;
                                    document.getElementById(`postcardLeftWord${clickTimeOfWord}`).innerText = textValue.substring(0,j);   //將文字加入第一行，直到超過可容納字數
                                    document.getElementById(`postcardLeftWord${clickTimeOfWord}`).style.color = wordColor;                //將文字顏色依照所選擇之顏色而改變
                                    document.getElementById(`postcardLeftWord${clickTimeOfWord+1}`).innerText =textValue.substring(i,textValue.length);  //將剩下的文字加入下一行
                                    document.getElementById(`postcardLeftWord${clickTimeOfWord+1}`).style.color = wordColor;    //將剩下的文字的顏色改變
                                    document.getElementById('postcardInsideText').value = '';     //將textarea的文字清空
                                }else{    //若測試文字寬度大於底線文字
                                    
                                    testLeftWordLimit3.innerText = textValue.substring(j,j+k);   //若j無法容納則所有字數則加k 
                                    if(document.getElementById('postcardLeftWord1').clientWidth-15>testLeftWordLimit3.clientWidth){
                                        k++;
                                        document.getElementById(`postcardLeftWord${clickTimeOfWord+1}`).innerText = textValue.substring(j,j+k);
                                        document.getElementById(`postcardLeftWord${clickTimeOfWord+2}`).style.color = wordColor;
                                    }else{
                                        testLeftWordLimit4.innerText = textValue.substring(j+k,j+k+l);
                                        if(document.getElementById('postcardLeftWord1').clientWidth-15>testLeftWordLimit4.clientWidth){
                                            l++;
                                            document.getElementById(`postcardLeftWord${clickTimeOfWord+2}`).innerText = textValue.substring(j+k,j+k+l);
                                            document.getElementById(`postcardLeftWord${clickTimeOfWord+2}`).style.color = wordColor;
                                        }else{
                                            testLeftWordLimit5.innerText = textValue.substring(j+k+l,j+k+l+m);
                                            if(document.getElementById('postcardLeftWord1').clientWidth-15>testLeftWordLimit5.clientWidth){
                                                m++;
                                                document.getElementById(`postcardLeftWord${clickTimeOfWord+3}`).innerText = textValue.substring(j+k+l,j+k+l+m);
                                                document.getElementById(`postcardLeftWord${clickTimeOfWord+3}`).style.color = wordColor;
                                            }else{
                                                testLeftWordLimit6.innerText = textValue.substring(j+k+l+m,j+k+l+m+n);
                                                if(document.getElementById('postcardLeftWord1').clientWidth-15>testLeftWordLimit6.clientWidth){
                                                n++;
                                                document.getElementById(`postcardLeftWord${clickTimeOfWord+4}`).innerText = textValue.substring(j+k+l+m,j+k+l+m+n);
                                                document.getElementById(`postcardLeftWord${clickTimeOfWord+4}`).style.color = wordColor;
                                                }else{
                                                    document.getElementById('posWarningSign').style.visibility = 'visible';
                                                }
                                            }
                                        }
                                        
                                    }
                                }
                            }
                            if(testLeftWordLimit2.innerHTML!=''&& testLeftWordLimit3.innerHTML!=''&& 
                            testLeftWordLimit4.innerHTML=='' && testLeftWordLimit5.innerHTML =='' && testLeftWordLimit6.innerHTML=='' ){
                                clickTimeOfWord+=1;
                                if(clickTimeOfWord>5){
                                    clickTimeOfWord ==5;
                                }
                            }
                            if(testLeftWordLimit2.innerHTML!=''&& testLeftWordLimit3.innerHTML!=''&& 
                            testLeftWordLimit4.innerHTML!='' && testLeftWordLimit5.innerHTML =='' && testLeftWordLimit6.innerHTML=='' ){
                                clickTimeOfWord+=2;
                                if(clickTimeOfWord>5){
                                    clickTimeOfWord ==5;
                                }
                            }
                            if(testLeftWordLimit2.innerHTML!=''&& testLeftWordLimit3.innerHTML!=''&& 
                            testLeftWordLimit4.innerHTML!='' && testLeftWordLimit5.innerHTML !='' && testLeftWordLimit6.innerHTML=='' ){
                                clickTimeOfWord+=3;
                                if(clickTimeOfWord>5){
                                    clickTimeOfWord ==5;
                                }
                            }
                            if(testLeftWordLimit2.innerHTML!=''&& testLeftWordLimit3.innerHTML!=''&& 
                            testLeftWordLimit4.innerHTML!='' && testLeftWordLimit5.innerHTML !='' && testLeftWordLimit6.innerHTML!='' ){
                                clickTimeOfWord+=4;
                                if(clickTimeOfWord>5){
                                    clickTimeOfWord ==5;
                                }
                            }
                        }
                    
                    }else{
                    document.getElementById('posWarningSign').style.visibility = 'visible';
                    clickTimeOfWord-=1;
                    
                    }
                }
                
                
            }
            function delWordNow(){
                document.getElementById('posWarningSign').style.visibility = 'hidden';
                document.getElementById(`postcardLeftWord${clickTimeOfWord}`).innerText ='';
                clickTimeOfWord-=1;
                
            }
            function sendFromToJs(){
                let fromText = document.getElementById('writeFrom').value;
                let toText = document.getElementById('writeTo').value;
                document.getElementById('posFrom').innerHTML = document.getElementById('posFrom').innerText + fromText;
                document.getElementById('posTo').innerHTML = document.getElementById('posTo').innerText + toText;
                document.getElementById('posFrom').style.color = fromWordColorVar;
                document.getElementById('posTo').style.color = toWordColorVar;
                document.getElementById('writeFrom').value = '';
                document.getElementById('writeTo').value = '';
                
            }
            function fromColorChange(fromWordColorId){
                for(let i=0; i<fromWordColorList.length;i++){
                    fromWordColorList[i].style.borderColor= "rgba(0, 0, 0, 0)";
                }
                document.getElementById(fromWordColorId).style.borderColor ="rgba(255, 0, 0, 0.4)";
                let wordColorFrom = window.getComputedStyle(document.getElementById(fromWordColorId)).getPropertyValue('background-color');
                fromWordColorVar = wordColorFrom;
                
            }
            function toColorChange(toWordColorId){
                for(let i=0; i<toWordColorList.length;i++){
                    toWordColorList[i].style.borderColor= "rgba(0, 0, 0, 0)";
                }
                document.getElementById(toWordColorId).style.borderColor ="rgba(255, 0, 0, 0.4)";
                let wordColorTo = window.getComputedStyle(document.getElementById(toWordColorId)).getPropertyValue('background-color');
                toWordColorVar = wordColorTo;
                
            }
            function posDelFromToJs(){
                
                document.getElementById('posFrom').innerHTML = 'From:';
                document.getElementById('posTo').innerHTML = 'To:';
                document.getElementById('posFrom').style.color = fromWordColorVar;
                document.getElementById('posTo').style.color = toWordColorVar;
            }
            function insertAfter(postcardLeftAll,rightPostcard){
                rightPostcard.parentNode.insertBefore(postcardLeftAll,rightPostcard.nextSibling);
            }
            function downloadPostcardFunc(downloadId){
                let shareContent = document.getElementById(downloadId);
                let width = shareContent.offsetWidth;
                let height = shareContent.offsetHeight;
                var scale = 1;
                var rect = shareContent.getBoundingClientRect();
                let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                let opts = {
                x: rect.left,
                y: rect.top,
                scrollY: -scrollTop,
                scale: scale, 
                width: width, 
                height: height,
                useCORS: true
                }
                
                html2canvas(shareContent, opts).then(function (canvas) {
                    let context = canvas.getContext('2d');
                    canvas.getContext('2d').scale(scale, scale);
                    context.mozImageSmoothingEnabled = false;
                    context.msImageSmoothingEnabled = false;
                    context.imageSmoothingEnabled = false;
                    document.body.append(canvas);
                    var a = document.createElement('a');
                    a.href = canvas.toDataURL('image/jpeg').replace("image/jpeg", "image/octet-stream");
                    a.download ='image.jpg';
                    a.click();
                    document.getElementsByTagName('canvas')[0].remove();
                });
            }
        }
        window.addEventListener('load',doFirst);
    </script>
    <script src="./js/logintext.js"></script>
</body>
</html>